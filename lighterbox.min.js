const ZOOM={MAX:4,DOUBLE_CLICK_LEVEL:2.5,WHEEL_STEP:.5,PINCH_SNAP_THRESHOLD:1.1},TOUCH={TAP_MAX_DISTANCE:15,TAP_MAX_TIME:300,DOUBLE_TAP_MAX_DISTANCE:30,SWIPE_MIN_DISTANCE:50},ANIM={EXIT_DURATION:300,ENTER_DURATION:400,EXIT_EASING:"ease-in",ENTER_EASING:"cubic-bezier(0.0, 0, 0.2, 1)"},_clickHandlers=new WeakMap;class LighterBox extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.groups=new Map,this.activeGroup=null,this.activePhotos=[],this.currentIndex=0,this.isOpen=!1,this.zoom={level:1,panX:0,panY:0,isPanning:!1,dragStartX:0,dragStartY:0,dragStartPanX:0,dragStartPanY:0},this.touch={startX:0,startY:0,startTime:0,lastTapTime:0,lastTapX:0,lastTapY:0,pinchStartDist:0,pinchStartZoom:1,pinchCenterX:0,pinchCenterY:0,isPinching:!1,moved:!1},this._hiResLoader=null,this._navTimeout=null,this._navId=0,this._imgLoadAC=null,this._boundKeyHandler=this._handleKeydown.bind(this),this._boundMouseMove=this._handleMouseMove.bind(this),this._boundMouseUp=this._handleMouseUp.bind(this)}connectedCallback(){this.render(),this.attachEventListeners(),this.discoverImages()}disconnectedCallback(){this.destroy()}destroy(){this.isOpen&&(this.isOpen=!1,this._isShowing=!1,document.body.style.overflow=""),this._cancelHiRes(),this._imgLoadAC&&(this._imgLoadAC.abort(),this._imgLoadAC=null),this.groups.forEach(t=>{t.forEach(t=>{if(t.sourceEl){const e=_clickHandlers.get(t.sourceEl);e&&(t.sourceEl.removeEventListener("click",e),_clickHandlers.delete(t.sourceEl))}})}),this.groups.clear(),this.detachEventListeners()}_$(t){return this.shadowRoot.getElementById(t)}discoverImages(){const t=document.querySelectorAll("[data-lighterbox]");this.groups.clear(),t.forEach(t=>{const e=t.getAttribute("data-lighterbox")||"default";let n=t.getAttribute("data-lighterbox-src");if(!n)if("A"===t.tagName)n=t.href;else if("IMG"===t.tagName)n=t.src;else{const e=t.querySelector("img");n=e?e.src:""}let i=t.getAttribute("data-lighterbox-thumbnail");if(!i)if("IMG"===t.tagName)i=t.src;else{const e=t.querySelector("img");i=e?e.src:n}let s=t.getAttribute("data-lighterbox-caption");if(!s)if("IMG"===t.tagName)s=t.alt||t.title||"";else{const e=t.querySelector("img");s=e?e.alt||e.title||"":t.title||""}this.groups.has(e)||this.groups.set(e,[]);const o=this.groups.get(e),a=o.length;o.push({src:n,thumbnail:i,caption:s,group:e,sourceEl:t});const r=t=>{t.preventDefault(),this.open(e,a)},h=_clickHandlers.get(t);h&&t.removeEventListener("click",h),_clickHandlers.set(t,r),t.addEventListener("click",r)})}refresh(){this.discoverImages()}addImage({src:t,thumbnail:e,caption:n,group:i}){const s=i||"default";this.groups.has(s)||this.groups.set(s,[]),this.groups.get(s).push({src:t,thumbnail:e||t,caption:n||"",group:s,sourceEl:null})}render(){this.shadowRoot.innerHTML='\n      <style>\n        :host {\n          --lb-primary: #2563eb;\n          --lb-overlay: rgba(0, 0, 0, 0.95);\n          --lb-text: #ffffff;\n          --lb-text-dim: #94a3b8;\n          --lb-border: #334155;\n        }\n\n        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }\n\n        /* ── Overlay ─────────────────────────── */\n        .lb-overlay {\n          position: fixed;\n          inset: 0;\n          background: var(--lb-overlay);\n          z-index: 10000;\n          backdrop-filter: blur(10px);\n          display: flex;\n          flex-direction: column;\n          opacity: 0;\n          visibility: hidden;\n          transition: opacity 0.3s ease, visibility 0.3s ease;\n        }\n        .lb-overlay.active {\n          opacity: 1;\n          visibility: visible;\n        }\n\n        /* ── Top bar ─────────────────────────── */\n        .lb-topbar {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 0.75rem 1.25rem;\n          background: linear-gradient(to bottom, rgba(0,0,0,0.6), transparent);\n          position: absolute;\n          top: 0; left: 0; right: 0;\n          z-index: 10;\n          pointer-events: none;\n        }\n        .lb-topbar > * { pointer-events: auto; }\n\n        .lb-counter {\n          color: var(--lb-text-dim);\n          font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n          font-size: 0.875rem;\n          min-width: 3rem;\n        }\n\n        .lb-actions {\n          display: flex;\n          gap: 0.5rem;\n          align-items: center;\n        }\n\n        .lb-btn {\n          background: rgba(255,255,255,0.1);\n          border: 1px solid var(--lb-border);\n          color: var(--lb-text);\n          padding: 0.4rem 0.75rem;\n          border-radius: 0.375rem;\n          cursor: pointer;\n          font-size: 0.8rem;\n          font-family: inherit;\n          transition: background 0.2s;\n        }\n        .lb-btn:hover { background: rgba(255,255,255,0.25); }\n\n        .lb-close {\n          background: rgba(0,0,0,0.6);\n          border: 1px solid var(--lb-border);\n          color: var(--lb-text);\n          width: 2.25rem; height: 2.25rem;\n          border-radius: 50%;\n          cursor: pointer;\n          display: flex; align-items: center; justify-content: center;\n          font-size: 1.25rem;\n          transition: background 0.2s;\n          line-height: 1;\n        }\n        .lb-close:hover { background: rgba(255,255,255,0.2); }\n\n        /* ── Stage ───────────────────────────── */\n        .lb-stage {\n          flex: 1;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          position: relative;\n          min-height: 0;\n          user-select: none;\n          -webkit-user-select: none;\n        }\n\n        /* ── Image wrapper (overflow clip for zoom) */\n        .lb-image-wrap {\n          position: relative;\n          overflow: hidden;\n          line-height: 0;\n          border-radius: 0.375rem;\n          transform: scale(0.92);\n          transition: transform 0.35s ease-out;\n        }\n        .lb-overlay.active .lb-image-wrap {\n          transform: scale(1);\n        }\n\n        /* ── Main image ──────────────────────── */\n        .lb-image {\n          display: block;\n          max-width: 90vw;\n          max-height: calc(100vh - 160px);\n          object-fit: contain;\n          -webkit-user-drag: none;\n          transform-origin: center center;\n        }\n        /* Cursor states */\n        .lb-image.zoomable { cursor: zoom-in; }\n        .lb-image.zoomed { cursor: grab; }\n        .lb-image.panning { cursor: grabbing; }\n\n        /* ── Spinner ─────────────────────────── */\n        .lb-spinner {\n          position: absolute;\n          top: 50%; left: 50%;\n          transform: translate(-50%, -50%);\n          width: 36px; height: 36px;\n          border: 3px solid var(--lb-border);\n          border-top-color: var(--lb-primary);\n          border-radius: 50%;\n          animation: lb-spin 0.8s linear infinite;\n          display: none;\n          pointer-events: none;\n        }\n        .lb-spinner.active { display: block; }\n        @keyframes lb-spin { to { transform: translate(-50%, -50%) rotate(360deg); } }\n\n        /* ── Error state ────────────────────────── */\n        .lb-error {\n          position: absolute;\n          top: 50%; left: 50%;\n          transform: translate(-50%, -50%);\n          color: var(--lb-text-dim);\n          font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n          font-size: 0.875rem;\n          text-align: center;\n          display: none;\n          pointer-events: none;\n        }\n        .lb-error.active { display: block; }\n\n        /* ── Nav buttons ─────────────────────── */\n        .lb-nav {\n          position: absolute;\n          top: 50%;\n          transform: translateY(-50%);\n          background: rgba(0,0,0,0.6);\n          border: 1px solid var(--lb-border);\n          color: var(--lb-text);\n          width: 3rem; height: 3rem;\n          border-radius: 50%;\n          cursor: pointer;\n          display: flex; align-items: center; justify-content: center;\n          font-size: 1.25rem;\n          transition: background 0.2s;\n          z-index: 5;\n        }\n        .lb-nav:hover { background: rgba(0,0,0,0.85); }\n        .lb-nav.prev { left: 1rem; }\n        .lb-nav.next { right: 1rem; }\n        .lb-nav.hidden, .lb-thumbs.hidden { display: none; }\n\n        /* ── Caption ─────────────────────────── */\n        .lb-caption {\n          text-align: center;\n          padding: 0.5rem 1rem;\n          color: var(--lb-text-dim);\n          font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n          font-size: 0.875rem;\n          background: linear-gradient(to top, rgba(0,0,0,0.4), transparent);\n          min-height: 1.75rem;\n        }\n\n        /* ── Thumbnails ──────────────────────── */\n        .lb-thumbs {\n          display: flex;\n          gap: 0.5rem;\n          padding: 0.75rem 1rem;\n          overflow-x: auto;\n          overflow-y: hidden;\n          background: rgba(0,0,0,0.7);\n          border-top: 1px solid var(--lb-border);\n          scrollbar-width: thin;\n          scrollbar-color: var(--lb-border) transparent;\n        }\n        .lb-thumbs::-webkit-scrollbar { height: 4px; }\n        .lb-thumbs::-webkit-scrollbar-track { background: transparent; }\n        .lb-thumbs::-webkit-scrollbar-thumb { background: var(--lb-border); border-radius: 2px; }\n\n        .lb-thumb {\n          height: 60px; min-width: 60px;\n          object-fit: cover;\n          border-radius: 0.25rem;\n          cursor: pointer;\n          opacity: 0.5;\n          transition: opacity 0.2s, border-color 0.2s;\n          border: 2px solid transparent;\n          flex-shrink: 0;\n        }\n        .lb-thumb:hover { opacity: 0.8; }\n        .lb-thumb.active { opacity: 1; border-color: var(--lb-primary); }\n\n        /* ── Responsive ──────────────────────── */\n        @media (max-width: 768px) {\n          .lb-topbar { padding: 0.5rem 0.75rem; }\n          .lb-nav { width: 2.5rem; height: 2.5rem; font-size: 1rem; }\n          .lb-nav.prev { left: 0.5rem; }\n          .lb-nav.next { right: 0.5rem; }\n          .lb-image { max-width: 100vw; max-height: calc(100vh - 140px); border-radius: 0; }\n          .lb-image-wrap { border-radius: 0; }\n          .lb-thumbs { padding: 0.5rem; }\n          .lb-thumb { height: 48px; min-width: 48px; }\n          .lb-btn { padding: 0.3rem 0.5rem; font-size: 0.75rem; }\n        }\n      </style>\n\n      <div class="lb-overlay" id="overlay">\n        <div class="lb-topbar">\n          <span class="lb-counter" id="counter"></span>\n          <div class="lb-actions">\n            <button class="lb-btn" id="downloadBtn" title="Download">&#8615; Download</button>\n            <button class="lb-btn" id="fullscreenBtn" title="Fullscreen">&#x26F6; Fullscreen</button>\n            <button class="lb-close" id="closeBtn" title="Close">&times;</button>\n          </div>\n        </div>\n\n        <div class="lb-stage" id="stage">\n          <button class="lb-nav prev" id="prevBtn">&#8249;</button>\n          <div class="lb-image-wrap" id="imageWrap">\n            <img class="lb-image" id="mainImage" alt="" draggable="false" />\n            <div class="lb-spinner" id="spinner"></div>\n            <div class="lb-error" id="error">&#x26A0; Image failed to load</div>\n          </div>\n          <button class="lb-nav next" id="nextBtn">&#8250;</button>\n        </div>\n\n        <div class="lb-caption" id="caption"></div>\n        <div class="lb-thumbs" id="thumbs"></div>\n      </div>\n    '}attachEventListeners(){this._$("closeBtn").addEventListener("click",()=>this.close()),this._$("prevBtn").addEventListener("click",()=>this.navigate(-1)),this._$("nextBtn").addEventListener("click",()=>this.navigate(1)),this._$("downloadBtn").addEventListener("click",()=>this.download()),this._$("fullscreenBtn").addEventListener("click",()=>this.toggleFullscreen()),this._$("stage").addEventListener("click",t=>{t.target===this._$("stage")&&this.close()}),this._$("imageWrap").addEventListener("wheel",t=>this._handleWheel(t),{passive:!1}),this._$("mainImage").addEventListener("dblclick",t=>this._handleDoubleClick(t)),this._$("imageWrap").addEventListener("mousedown",t=>this._handleMouseDown(t)),this.shadowRoot.addEventListener("mousemove",this._boundMouseMove),this.shadowRoot.addEventListener("mouseup",this._boundMouseUp),this._$("stage").addEventListener("touchstart",t=>this._handleTouchStart(t),{passive:!0}),this._$("stage").addEventListener("touchmove",t=>this._handleTouchMove(t),{passive:!1}),this._$("stage").addEventListener("touchend",t=>this._handleTouchEnd(t),{passive:!0}),document.addEventListener("keydown",this._boundKeyHandler)}detachEventListeners(){document.removeEventListener("keydown",this._boundKeyHandler),this.shadowRoot.removeEventListener("mousemove",this._boundMouseMove),this.shadowRoot.removeEventListener("mouseup",this._boundMouseUp)}_handleKeydown(t){if(this.isOpen)switch(t.key){case"ArrowLeft":t.preventDefault(),this.navigate(-1);break;case"ArrowRight":t.preventDefault(),this.navigate(1);break;case"Escape":this.close()}}open(t,e=0){const n=t||"default";this.groups.has(n)&&(this.activeGroup=n,this.activePhotos=this.groups.get(n),this.currentIndex=e,this.isOpen=!0,this._$("overlay").classList.add("active"),document.body.style.overflow="hidden",this.displayPhoto(),this.renderThumbnails(),this.preloadAdjacent(),this.dispatchEvent(new CustomEvent("lighterbox:open",{detail:{group:n,index:e}})))}close(){if(!this.isOpen)return;this.isOpen=!1,this._isShowing=!1,this.resetZoom(!1),this._cancelHiRes();this._$("mainImage").style.opacity="0",this._imgLoadAC&&(this._imgLoadAC.abort(),this._imgLoadAC=null),this._$("overlay").classList.remove("active"),document.body.style.overflow="",this.dispatchEvent(new CustomEvent("lighterbox:close"))}navigate(t){this.activePhotos.length&&(this.resetZoom(!1),this._cancelHiRes(),this.currentIndex+=t,this.currentIndex<0&&(this.currentIndex=this.activePhotos.length-1),this.currentIndex>=this.activePhotos.length&&(this.currentIndex=0),this.displayPhoto(),this.updateActiveThumbnail(),this.preloadAdjacent(),this.dispatchEvent(new CustomEvent("lighterbox:navigate",{detail:{group:this.activeGroup,index:this.currentIndex}})))}goTo(t){t<0||t>=this.activePhotos.length||(this.resetZoom(!1),this._cancelHiRes(),this.currentIndex=t,this.displayPhoto(),this.updateActiveThumbnail(),this.preloadAdjacent(),this.dispatchEvent(new CustomEvent("lighterbox:navigate",{detail:{group:this.activeGroup,index:this.currentIndex}})))}async displayPhoto(){const t=this.activePhotos[this.currentIndex];if(!t)return;const e=++this._navId,n=this._$("mainImage"),i=this._$("spinner"),s=this._$("imageWrap");if(this._isShowing&&(await s.animate([{opacity:1,transform:"scale(1)"},{opacity:0,transform:"translateY(-10px) scale(0.98)"}],{duration:ANIM.EXIT_DURATION,easing:ANIM.EXIT_EASING}).finished,this._navId!==e))return;this._isShowing=!1,n.style.opacity="0",i.classList.add("active"),this._$("error").classList.remove("active"),this._imgLoadAC&&this._imgLoadAC.abort(),this._imgLoadAC=new AbortController;const{signal:o}=this._imgLoadAC,a=await new Promise(e=>{n.addEventListener("load",()=>e(!0),{once:!0,signal:o}),n.addEventListener("error",()=>e(!1),{once:!0,signal:o}),n.src=t.thumbnail});if(this._navId!==e)return;if(i.classList.remove("active"),!a)return void this._$("error").classList.add("active");n.style.opacity="1",this._isShowing=!0,s.animate([{opacity:0,transform:"translateY(16px) scale(0.96)"},{opacity:1,transform:"scale(1)"}],{duration:ANIM.ENTER_DURATION,easing:ANIM.ENTER_EASING}),this._updateZoomCursor(),t.src!==t.thumbnail&&this._loadHiRes(t.src),this._$("counter").textContent=this.activePhotos.length>1?`${this.currentIndex+1} / ${this.activePhotos.length}`:"",this._$("caption").textContent=t.caption||"";const r=this.activePhotos.length<=1;this._$("prevBtn").classList.toggle("hidden",r),this._$("nextBtn").classList.toggle("hidden",r),this._$("thumbs").classList.toggle("hidden",r)}_loadHiRes(t){this._cancelHiRes(),this._hiResLoader=new Image,this._hiResLoaderAC=new AbortController,this._hiResLoader.addEventListener("load",()=>{const e=this._$("mainImage"),n=this.activePhotos[this.currentIndex];n&&t===n.src&&(e.src=t),this._hiResLoader=null,this._hiResLoaderAC=null},{once:!0,signal:this._hiResLoaderAC.signal}),this._hiResLoader.src=t}_cancelHiRes(){this._hiResLoaderAC&&(this._hiResLoaderAC.abort(),this._hiResLoaderAC=null),this._hiResLoader=null}renderThumbnails(){const t=this._$("thumbs");t.innerHTML="",this.activePhotos.forEach((e,n)=>{const i=document.createElement("img");i.className="lb-thumb"+(n===this.currentIndex?" active":""),i.src=e.thumbnail,i.alt=e.caption||"",i.dataset.index=n,i.addEventListener("click",()=>this.goTo(n)),t.appendChild(i)})}updateActiveThumbnail(){this._$("thumbs").querySelectorAll(".lb-thumb").forEach((t,e)=>{t.classList.toggle("active",e===this.currentIndex),e===this.currentIndex&&t.scrollIntoView({behavior:"smooth",inline:"center",block:"nearest"})})}resetZoom(t=!0){if(1===this.zoom.level&&0===this.zoom.panX&&0===this.zoom.panY)return;const e=this._$("mainImage"),n=e.style.transform||"scale(1)";this.zoom.level=1,this.zoom.panX=0,this.zoom.panY=0,this.zoom.isPanning=!1,this._applyTransform(),t&&e.animate([{transform:n},{transform:"scale(1)"}],{duration:300,easing:"ease"}),this._updateZoomCursor()}setZoomAtPoint(t,e,n,i=!1){const s=this._$("imageWrap").getBoundingClientRect(),o=e-s.left-s.width/2,a=n-s.top-s.height/2,r=this.zoom.level;if((t=Math.max(1,Math.min(this._maxZoom(),t)))===r)return;const h=t/r;this.zoom.panX=o-(o-this.zoom.panX)*h,this.zoom.panY=a-(a-this.zoom.panY)*h,this.zoom.level=t,this._clampPan();const l=this._$("mainImage"),c=l.style.transform||"scale(1)";this._applyTransform(),i&&l.animate([{transform:c},{transform:l.style.transform||"scale(1)"}],{duration:300,easing:"ease"}),this._updateZoomCursor()}_maxZoom(){return ZOOM.MAX}_clampPan(){const t=this._$("mainImage");if(!t)return;const e=t.clientWidth,n=t.clientHeight,i=this.zoom.level,s=Math.max(0,e*(i-1)/2),o=Math.max(0,n*(i-1)/2);this.zoom.panX=Math.max(-s,Math.min(s,this.zoom.panX)),this.zoom.panY=Math.max(-o,Math.min(o,this.zoom.panY))}_applyTransform(){const t=this._$("mainImage");t&&(this.zoom.level<=1?t.style.transform="":t.style.transform=`translate(${this.zoom.panX}px, ${this.zoom.panY}px) scale(${this.zoom.level})`)}_updateZoomCursor(){const t=this._$("mainImage");t&&(t.classList.toggle("zoomable",this.zoom.level<this._maxZoom()&&this.zoom.level<=1),t.classList.toggle("zoomed",this.zoom.level>1&&!this.zoom.isPanning),t.classList.toggle("panning",this.zoom.isPanning))}_handleWheel(t){if(!this.isOpen)return;t.preventDefault();const e=t.deltaY<0?ZOOM.WHEEL_STEP:-ZOOM.WHEEL_STEP,n=this.zoom.level+e;this.setZoomAtPoint(n,t.clientX,t.clientY)}_handleDoubleClick(t){this.isOpen&&(this.zoom.level>1?this.resetZoom(!0):this.setZoomAtPoint(ZOOM.DOUBLE_CLICK_LEVEL,t.clientX,t.clientY,!0))}_handleMouseDown(t){!this.isOpen||this.zoom.level<=1||(t.preventDefault(),this.zoom.isPanning=!0,this.zoom.dragStartX=t.clientX,this.zoom.dragStartY=t.clientY,this.zoom.dragStartPanX=this.zoom.panX,this.zoom.dragStartPanY=this.zoom.panY,this._updateZoomCursor())}_handleMouseMove(t){this.zoom.isPanning&&(this.zoom.panX=this.zoom.dragStartPanX+(t.clientX-this.zoom.dragStartX),this.zoom.panY=this.zoom.dragStartPanY+(t.clientY-this.zoom.dragStartY),this._clampPan(),this._applyTransform())}_handleMouseUp(){this.zoom.isPanning&&(this.zoom.isPanning=!1,this._updateZoomCursor())}_touchDistance(t,e){const n=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(n*n+i*i)}_handleTouchStart(t){this.isOpen&&(2===t.touches.length?(this.touch.isPinching=!0,this.touch.pinchStartDist=this._touchDistance(t.touches[0],t.touches[1]),this.touch.pinchStartZoom=this.zoom.level,this.touch.pinchCenterX=(t.touches[0].clientX+t.touches[1].clientX)/2,this.touch.pinchCenterY=(t.touches[0].clientY+t.touches[1].clientY)/2):1===t.touches.length&&(this.touch.startX=t.touches[0].clientX,this.touch.startY=t.touches[0].clientY,this.touch.startTime=Date.now(),this.touch.moved=!1,this.zoom.level>1&&(this.zoom.isPanning=!0,this.zoom.dragStartX=t.touches[0].clientX,this.zoom.dragStartY=t.touches[0].clientY,this.zoom.dragStartPanX=this.zoom.panX,this.zoom.dragStartPanY=this.zoom.panY)))}_handleTouchMove(t){if(this.isOpen)if(2===t.touches.length&&this.touch.isPinching){t.preventDefault();const e=this._touchDistance(t.touches[0],t.touches[1])/this.touch.pinchStartDist,n=Math.max(1,Math.min(this._maxZoom(),this.touch.pinchStartZoom*e));this.setZoomAtPoint(n,this.touch.pinchCenterX,this.touch.pinchCenterY)}else 1===t.touches.length&&(this.touch.moved=!0,this.zoom.level>1&&this.zoom.isPanning&&(t.preventDefault(),this.zoom.panX=this.zoom.dragStartPanX+(t.touches[0].clientX-this.zoom.dragStartX),this.zoom.panY=this.zoom.dragStartPanY+(t.touches[0].clientY-this.zoom.dragStartY),this._clampPan(),this._applyTransform()))}_handleTouchEnd(t){if(!this.isOpen)return;if(this.touch.isPinching)return this.touch.isPinching=!1,void(this.zoom.level<ZOOM.PINCH_SNAP_THRESHOLD&&this.resetZoom(!0));if(this.zoom.isPanning=!1,!t.changedTouches.length)return;const e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY,i=e-this.touch.startX,s=n-this.touch.startY,o=Date.now()-this.touch.startTime;if(Math.sqrt(i*i+s*s)<TOUCH.TAP_MAX_DISTANCE&&o<TOUCH.TAP_MAX_TIME){const t=Date.now();if(t-this.touch.lastTapTime<TOUCH.TAP_MAX_TIME&&Math.abs(e-this.touch.lastTapX)<TOUCH.DOUBLE_TAP_MAX_DISTANCE&&Math.abs(n-this.touch.lastTapY)<TOUCH.DOUBLE_TAP_MAX_DISTANCE)return this.touch.lastTapTime=0,void(this.zoom.level>1?this.resetZoom(!0):this.setZoomAtPoint(ZOOM.DOUBLE_CLICK_LEVEL,e,n,!0));this.touch.lastTapTime=t,this.touch.lastTapX=e,this.touch.lastTapY=n}this.zoom.level<=1&&Math.abs(i)>TOUCH.SWIPE_MIN_DISTANCE&&Math.abs(i)>Math.abs(s)&&this.navigate(i<0?1:-1)}preloadAdjacent(){const t=this.activePhotos.length;if(t<=1)return;[(this.currentIndex-1+t)%t,(this.currentIndex+1)%t].forEach(t=>{(new Image).src=this.activePhotos[t].src})}download(){const t=this.activePhotos[this.currentIndex];if(!t)return;const e=document.createElement("a");e.href=t.src,e.download=t.caption||"image",e.click(),this.dispatchEvent(new CustomEvent("lighterbox:download",{detail:{group:this.activeGroup,index:this.currentIndex,src:t.src}}))}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():this.shadowRoot.host.requestFullscreen().catch(()=>{})}}customElements.define("lighter-box",LighterBox),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-lighterbox]").length&&!document.querySelector("lighter-box")&&document.body.appendChild(document.createElement("lighter-box"))}),"undefined"!=typeof module&&module.exports&&(module.exports=LighterBox);